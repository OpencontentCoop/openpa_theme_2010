{include name=menu_control node=$node uri='design:parts/common/menu_control.tpl'}

{def $attributi_da_evidenziare = openpaini( 'GestioneAttributi', 'attributi_da_evidenziare' )
	 $attributi_a_destra = openpaini( 'GestioneAttributi', 'attributi_a_destra' )
	 $classes_parent_to_edit = openpaini( 'GestioneClassi', 'classi_figlie_da_editare' )}

{def $style = 'col-odd'
     $classes = array( 'pagina_trasparenza' )
     $children = fetch( 'content', 'list', hash( 'parent_node_id', $node.node_id,
                                                 'offset', $view_parameters.offset,
                                                 'sort_by', $node.sort_array,
                                                 'class_filter_type', 'exclude',
                                                 'class_filter_array', $classes,
                                                 'limit', openpaini( 'GestioneFigli', 'limite_paginazione', 25 ) ) )
     $children_count=fetch( 'content', 'list_count', hash( 'parent_node_id', $node.node_id,
                                                           'class_filter_type', 'exclude',
                                                           'class_filter_array', $classes) )}
{if $children_count|eq(0)}
    {set $children = fetch( 'content', 'list', hash( 'parent_node_id', $node.node_id,
                                                 'offset', $view_parameters.offset,
                                                 'sort_by', $node.sort_array,
                                                 'class_filter_type', 'include',
                                                 'class_filter_array', $classes,
                                                 'limit', openpaini( 'GestioneFigli', 'limite_paginazione', 25 ) ) )
         $children_count=fetch( 'content', 'list_count', hash( 'parent_node_id', $node.node_id,
                                                           'class_filter_type', 'include',
                                                           'class_filter_array', $classes) )}
{/if}
<div class="border-box">
<div class="border-content">

 <div class="global-view-full content-view-full">
  <div class="class-{$node.object.class_identifier}">

	<h1>{$node.name|wash()}</h1>
    
    {* DATA e ULTIMAMODIFICA *}
	{include name = last_modified
             node = $node             
             uri = 'design:parts/openpa/last_modified.tpl'}

	
    {* EDITOR TOOLS *}
	{include name = editor_tools
             node = $node             
             uri = 'design:parts/openpa/editor_tools.tpl'}


    {* ATTRIBUTI : mostra i contenuti del nodo *}
    <div class="attributi-principali float-break col col-notitle">
        <div class="col-content"><div class="col-content-design">
            {if and( is_set($node.data_map.image), $node.data_map.image.has_content )}
            <div class="main-image left">
                {attribute_view_gui attribute=$node.data_map.image image_class='medium'}
            </div>
            {/if}
            {if and( is_set($node.data_map.contenuto), $node.data_map.contenuto.has_content )}
            {attribute_view_gui attribute=$node.data_map.contenuto}
            {/if}
        </div></div>
    </div>

    <div class="attributi-base">        
    {if $children_count|gt(0)}
        {foreach $children as $child }
            {if $style|eq('col-even')}{set $style='col-odd'}{else}{set $style='col-even'}{/if}
            <div class="{$style} col col-notitle float-break">
                <div class="col-content"><div class="col-content-design">
                    {node_view_gui view='line' show_image='no' content_node=$child.object.main_node}
                </div></div>
            </div>
        {/foreach}
        {include name=navigator
                 uri='design:navigator/google.tpl'
                 page_uri=$node.url_alias
                 item_count=$children_count
                 view_parameters=$view_parameters
                 item_limit=openpaini( 'GestioneFigli', 'limite_paginazione', 25 ) }
    {else}
    <div class="warning message-warning">
        <p>Sezione in allestimento</p>
    </div>
    {/if}
    </div>
    
    {if and( $node.can_edit,
             or(
                 and( is_set( $node.data_map.guida_alla_compilazione ), $node.data_map.guida_alla_compilazione.has_content ),
                 and( is_set( $node.data_map.applicabilita ), $node.data_map.applicabilita.has_content ),
                 and( is_set( $node.data_map.frequenza_di_aggiornamento ), $node.data_map.frequenza_di_aggiornamento.has_content ),
                 and( is_set( $node.data_map.decorrenza_di_pubblicazione ), $node.data_map.decorrenza_di_pubblicazione.has_content ),
                 and( is_set( $node.data_map.termine_pubblicazione ), $node.data_map.termine_pubblicazione.has_content )
             )
          )}
    <div class="oggetti-correlati">
        <div class="border-header border-box box-violet-gray box-allegati-header">
            <div class="border-tl"><div class="border-tr"><div class="border-tc"></div></div></div>
            <div class="border-ml"><div class="border-mr"><div class="border-mc">
                <div class="border-content">
                    <h2>{$node.data_map.guida_alla_compilazione.contentclass_attribute_name}</h2>
                </div>
            </div></div></div>
        </div>
        <div class="border-body border-box box-violet box-allegati-content">
            <div class="border-ml"><div class="border-mr"><div class="border-mc">
            <div class="border-content">
                <div class="attributi-base">                
                    {if and( is_set( $node.data_map.guida_alla_compilazione ), $node.data_map.guida_alla_compilazione.has_content )}
                        {if $style|eq( 'col-even' )}{set $style = 'col-odd'}{else}{set $style = 'col-even'}{/if}
                        <div class="{$style} col col-notitle float-break">
                            <div class="col-content"><div class="col-content-design">
                            {attribute_view_gui attribute=$node.data_map.guida_alla_compilazione}
                            </div></div>
                        </div>
                    {/if}
                    {if and( is_set( $node.data_map.applicabilita ), $node.data_map.applicabilita.has_content )}
                        {if $style|eq( 'col-even' )}{set $style = 'col-odd'}{else}{set $style = 'col-even'}{/if}
                        <div class="{$style} col float-break">
                            <div class="col-title"><span class="label">{$node.data_map.applicabilita.contentclass_attribute_name}</span></div>
                            <div class="col-content"><div class="col-content-design">
                            {attribute_view_gui attribute=$node.data_map.applicabilita}
                            </div></div>
                        </div>
                    {/if}
                    {if and( is_set( $node.data_map.frequenza_di_aggiornamento ), $node.data_map.frequenza_di_aggiornamento.has_content, $node.data_map.frequenza_di_aggiornamento.data_text|ne('') )}
                        {if $style|eq( 'col-even' )}{set $style = 'col-odd'}{else}{set $style = 'col-even'}{/if}
                        <div class="{$style} col float-break">
                            <div class="col-title"><span class="label">{$node.data_map.frequenza_di_aggiornamento.contentclass_attribute_name}</span></div>
                            <div class="col-content"><div class="col-content-design">
                            {attribute_view_gui attribute=$node.data_map.frequenza_di_aggiornamento}
                            </div></div>
                        </div>
                    {/if}
                    {if and( is_set( $node.data_map.decorrenza_di_pubblicazione ), $node.data_map.decorrenza_di_pubblicazione.has_content )}
                        {if $style|eq( 'col-even' )}{set $style = 'col-odd'}{else}{set $style = 'col-even'}{/if}
                        <div class="{$style} col float-break">
                            <div class="col-title"><span class="label">{$node.data_map.decorrenza_di_pubblicazione.contentclass_attribute_name}</span></div>
                            <div class="col-content"><div class="col-content-design">
                            {attribute_view_gui attribute=$node.data_map.decorrenza_di_pubblicazione}
                            </div></div>
                        </div>
                    {/if}
                    {if and( is_set( $node.data_map.termine_pubblicazione ), $node.data_map.termine_pubblicazione.has_content )}
                        {if $style|eq( 'col-even' )}{set $style = 'col-odd'}{else}{set $style = 'col-even'}{/if}
                        <div class="{$style} col float-break">
                            <div class="col-title"><span class="label">{$node.data_map.termine_pubblicazione.contentclass_attribute_name}</span></div>
                            <div class="col-content"><div class="col-content-design">
                            {attribute_view_gui attribute=$node.data_map.termine_pubblicazione}
                            </div></div>
                        </div>
                    {/if}                    
                </div>
            </div>
            </div></div></div>
            <div class="border-bl"><div class="border-br"><div class="border-bc"></div></div></div>
        </div>
    </div> 
    {/if}
    
    {* ATTRIBUTI BASE: mostra i contenuti del nodo *}
        
    <div class="oggetti-correlati" style="font-size: .85em">
        <div class="border-header border-box box-violet-gray box-allegati-header">
            <div class="border-tl"><div class="border-tr"><div class="border-tc"></div></div></div>
            <div class="border-ml"><div class="border-mr"><div class="border-mc">
                <div class="border-content">
                    <h2>Guida ai contenuti di {$node.parent.name|wash()} &raquo; {$node.name|wash()}</h2>
                </div>
            </div></div></div>
        </div>
        <div class="border-body border-box box-violet box-allegati-content">
            <div class="border-ml"><div class="border-mr"><div class="border-mc">
            <div class="border-content">
                {include name = attributi_base
                         uri = 'design:parts/openpa/attributi_base.tpl'
                         node = $node}
            </div>
            </div></div></div>
            <div class="border-bl"><div class="border-br"><div class="border-bc"></div></div></div>
        </div>
    </div>    

    
    {* TIP A FRIEND *}
    {include name=tipafriend node=$node uri='design:parts/common/tip_a_friend.tpl'}    
	
    </div>
</div>

</div>
</div>
